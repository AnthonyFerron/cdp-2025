// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Country {
  id_country Int    @id @default(autoincrement())
  name       String @unique @db.VarChar(50)
  image      String @db.VarChar(50)

  users User[]
}

model Cosmetic {
  id_cosmetic Int     @id @default(autoincrement())
  name        String  @db.VarChar(50)
  type        String  @db.VarChar(50)
  price       Int
  image       String  @db.VarChar(255)
  is_active   Boolean

  owned owned[]
}

model Badge {
  id_badge Int    @id @default(autoincrement())
  name     String @db.VarChar(50)
  icon     String @db.VarChar(50)

  Mission Mission[]
  earned  earned[]
}

model Mission {
  id_mission   Int      @id @default(autoincrement())
  title        String   @db.VarChar(50)
  content      String   @db.VarChar(1000)
  target_type  String   @db.VarChar(50)
  reward_xp    Int?
  reward_coins Int?
  id_badge     Int?
  create_at    DateTime @default(now())
  id_course    Int

  Badge    Badge?     @relation(fields: [id_badge], references: [id_badge])
  achieved achieved[]
}

model Programming_Language {
  id_language Int     @id @default(autoincrement())
  name        String  @unique @db.VarChar(50)
  is_public   Boolean

  Course Course[]
}

model Course {
  id_course      Int      @id @default(autoincrement())
  title          String   @db.VarChar(50)
  slug           String   @db.VarChar(50)
  difficulty     Int
  is_published   Boolean
  estimated_time Int
  id_language    Int
  create_at      DateTime @default(now())

  Programming_Language Programming_Language @relation(fields: [id_language], references: [id_language])
  Lore                 Lore[]
  Course_section       Course_section[]
  Quiz                 Quiz[]
  progress             progress[]
  to_gamify            to_gamify[]
}

model Lore {
  id_lore   Int    @id @default(autoincrement())
  content   String @db.VarChar(50)
  id_course Int

  Course Course @relation(fields: [id_course], references: [id_course])
}

model Course_section {
  id_course_section Int    @id @default(autoincrement())
  order_by          Int
  title             String @db.VarChar(50)
  content           String @db.VarChar(8000)
  image             String? @db.VarChar(50)
  id_course         Int
  code              String

  Course   Course     @relation(fields: [id_course], references: [id_course])
  progress progress[]

  @@unique([id_course, order_by])
}

model Quiz {
  id_quiz    Int  @id @default(autoincrement())
  difficulty Int
  time_limit Int
  id_course  Int?

  Course        Course?         @relation(fields: [id_course], references: [id_course])
  quiz_question quiz_question[]
  Quiz_Attempt  Quiz_Attempt[]
}

model quiz_question {
  id_quiz_question Int    @id @default(autoincrement())
  question         String @db.VarChar(50)
  choices          String @db.VarChar(500)
  answer           String @db.VarChar(50)
  id_quiz          Int

  Quiz Quiz @relation(fields: [id_quiz], references: [id_quiz])
}

model Game {
  id_game    Int @id @default(autoincrement())
  difficulty Int
  time_limit Int

  Help_Content Help_Content[]
  Game_Attempt Game_Attempt[]
  to_gamify    to_gamify[]
}

model Help_Content {
  id_help_content Int    @id @default(autoincrement())
  content         String @db.VarChar(200)
  order_by        Int
  id_game         Int

  Game Game   @relation(fields: [id_game], references: [id_game])
  Used Used[]
}

model progress {
  id_progress       Int    @id @default(autoincrement())
  progress_point    Int
  id_course_section Int
  id_course         Int
  user_id           String

  Course_section Course_section @relation(fields: [id_course_section], references: [id_course_section])
  Course         Course         @relation(fields: [id_course], references: [id_course])
  User           User           @relation(fields: [user_id], references: [id])
}

model Quiz_Attempt {
  id_quiz_attempt Int      @id @default(autoincrement())
  score           Int
  passed          Boolean
  started_at      DateTime
  completed_at    DateTime
  id_user         String
  id_quiz         Int

  User User @relation(fields: [id_user], references: [id])
  Quiz Quiz @relation(fields: [id_quiz], references: [id_quiz])
}

model Game_Attempt {
  id_game_attempt Int      @id @default(autoincrement())
  score           Int
  passed          Boolean
  started_at      DateTime
  completed_at    DateTime
  user_id         String
  id_game         Int

  User User @relation(fields: [user_id], references: [id])
  Game Game @relation(fields: [id_game], references: [id_game])
}

model owned {
  user_id     String
  id_cosmetic Int
  is_equiped  Boolean
  aquired_at  DateTime

  User     User     @relation(fields: [user_id], references: [id])
  Cosmetic Cosmetic @relation(fields: [id_cosmetic], references: [id_cosmetic])

  @@id([user_id, id_cosmetic])
}

model earned {
  id_user    String
  id_badge   Int
  is_equiped Boolean
  earned_at  DateTime

  User  User  @relation(fields: [id_user], references: [id])
  Badge Badge @relation(fields: [id_badge], references: [id_badge])

  @@id([id_user, id_badge])
}

model achieved {
  id_user    String
  id_mission Int
  is_completed     Boolean

  User    User    @relation(fields: [id_user], references: [id])
  Mission Mission @relation(fields: [id_mission], references: [id_mission])

  @@id([id_user, id_mission])
}

model to_gamify {
  id_course Int
  id_game   Int

  Course Course @relation(fields: [id_course], references: [id_course])
  Game   Game   @relation(fields: [id_game], references: [id_game])

  @@id([id_course, id_game])
}

model Used {
  user_id         String
  id_help_content Int

  User         User         @relation(fields: [user_id], references: [id])
  Help_Content Help_Content @relation(fields: [id_help_content], references: [id_help_content])

  @@id([user_id, id_help_content])
}

model User {
  id            String    @id
  name          String
  email         String
  emailVerified Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @default(now()) @updatedAt
  sessions      Session[]
  accounts      Account[]

  experience Int
  levels     Int
  coins      Int
  role       String   @db.VarChar(50)
  id_country Int
  create_at  DateTime @default(now())

  Country      Country        @relation(fields: [id_country], references: [id_country])
  progress     progress[]
  Quiz_Attempt Quiz_Attempt[]
  Game_Attempt Game_Attempt[]
  owned        owned[]
  earned       earned[]
  achieved     achieved[]
  Used         Used[]

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  @@map("verification")
}